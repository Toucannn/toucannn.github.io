<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<body style="margin: 0;">
  <div id="map" style="height: 100vh;"></div>
  <script>
    const map = L.map('map').setView([58.378, 26.729], 12);
    const osm = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: 'Â© OpenStreetMap'
    }).addTo(map);
  
    
    // Layers control containers
    const baseLayers = { 'OpenStreetMap': osm };
    let overlays = {};
    // const layersControl = L.control.layers(baseLayers, overlays, { collapsed: false }).addTo(map); // Leaflet layers control [3](https://leafletjs.com/examples/layers-control/)
  
  
    // --- Configure your repo ---
    const owner = 'toucannn';
    const repo = 'toucannn.github.io';
    const branch = 'main';       // or 'gh-pages'
    const path = 'assets/layers';       // the folder with .geojson files
  
    // Optional: add an auth token to raise rate limits
    const headers = {
      'Accept': 'application/vnd.github+json'
      // ,'Authorization': 'Bearer YOUR_TOKEN'  // uncomment if needed
    };
  
    async function loadAllLayers() {
      const url = `https://api.github.com/repos/${owner}/${repo}/contents/${path}?ref=${branch}`;
      const listing = await (await fetch(url, { headers })).json();
  
      // Filter to .geojson files
      const files = listing.filter(entry =>
        entry.type === 'file' && entry.name.toLowerCase().endsWith('.geojson')
      );
  
      for (const file of files) {
        // Preferred: use the download_url (a raw URL with proper CORS for JSON)
        console.log("downloading from url:", file);
        const layerName = file.name.replace('.geojson', '');
        console.log("layerName", layerName)
        const geojson = await (await fetch(file.download_url)).json();
        const layer = L.geoJSON(geojson)
        overlays[layerName] = layer;
        layer.addTo(map);
      }
    }
  
    loadAllLayers().catch(console.error).then(() => {
      console.log("overlays", overlays)
      const layersControl = L.control.layers(baseLayers, overlays, { collapsed: false }).addTo(map); // Leaflet layers control [3](https://leafletjs.com/examples/layers-control/)
    })
    console.log("adding layer control")
    let testobj = {}
    console.log("testobj", testobj)
    testobj["test-a"] = "test1"
    testobj["test-b"] = "test2"
    console.log("testobj", testobj)
  
    console.log("overlays", overlays)
  
  </script>
</body>